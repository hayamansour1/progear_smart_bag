<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reset password</title>
  <style>
    body{font-family:system-ui,Arial;padding:24px;max-width:480px;margin:auto}
    .card{border:1px solid #ddd;border-radius:12px;padding:20px}
    input,button{width:100%;padding:12px;margin:8px 0;border-radius:8px;border:1px solid #ccc}
    button{background:#1e3a8a;color:#fff;border:none;cursor:pointer}
    .ok{color:#0a7d17;margin-top:8px}
    .err{color:#b00020;margin-top:8px}
  </style>
  <script type="importmap">
  {"imports":{"@supabase/supabase-js":"https://esm.sh/@supabase/supabase-js@2"}}
  </script>
</head>
<body>
  <h2>Set a new password</h2>
  <div class="card">
    <p>Enter your new password below.</p>
    <input id="pw" type="password" placeholder="New password" />
    <input id="pw2" type="password" placeholder="Confirm new password" />
    <button id="btn">Update password</button>
    <div id="msg"></div>
  </div>

  <script type="module">
    import { createClient } from '@supabase/supabase-js'

    // ← استبدلي القيمتين من ملف .env عندك
    const SUPABASE_URL = "https://ywulwmvyhagsdfnzyvab.supabase.co"
    const SUPABASE_ANON_KEY = "sb_secret_jMcmm8ZlIPct87pKlCOZiA_ds6iQGrL"

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
    const msg = (t,c)=>{const m=document.getElementById('msg');m.className=c;m.textContent=t}

    document.getElementById('btn').addEventListener('click', async () => {
      const p1 = document.getElementById('pw').value.trim()
      const p2 = document.getElementById('pw2').value.trim()
      if (!p1 || p1.length < 6) return msg('Password must be at least 6 chars.','err')
      if (p1 !== p2) return msg('Passwords do not match.','err')
      try {
        const { error } = await supabase.auth.updateUser({ password: p1 })
        if (error) throw error
        msg('Password updated. You can now close this page and sign in.','ok')
      } catch (e) {
        msg(e.message || 'Failed to update password. Please try again.','err')
      }
    })
  </script>
</body>
</html>
